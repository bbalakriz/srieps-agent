---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sreips-forwarder-service-account
  namespace: sreips-core
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sreips-runner-service-account
  namespace: sreips-core
---
apiVersion: v1
kind: Secret
metadata:
  name: sreips-playbooks-config-secret
  namespace: sreips-core
data:
  active_playbooks.yaml: cGxheWJvb2tfcmVwb3M6CiAgY3VzdG9tX2FjdGlvbnM6CiAgICB1cmw6ICJmaWxlOi8vL2V0Yy9yb2J1c3RhL3BsYXlib29rcy9jdXN0b21fcGxheWJvb2tzIgogICAgcGlwX2luc3RhbGw6IEZhbHNlCgpzaW5rc19jb25maWc6Ci0gc2xhY2tfc2luazoKICAgIGFwaV9rZXk6IHhveGItOTU1NjYyNDk3OTQxMi05NjAzMDA2MTE1MzAxLVEwdDFsQWE2czNpbFlvSllZYkRvbm81dwogICAgZGlzYWJsZV9ob2xtZXNfbm90ZTogdHJ1ZQogICAgbmFtZTogbWFpbl9zbGFja19zaW5rCiAgICBzbGFja19jaGFubmVsOiBzcmVpcHMtaGVscGVyCgpnbG9iYWxfY29uZmlnOgogIGNsdXN0ZXJfbmFtZTogb3BlbnNoaWZ0LXByb2QKICBhY2NvdW50X2lkOiAiIgogIGNoZWNrX3Byb21ldGhldXNfZmxhZ3M6IHRydWUKICBjbHVzdGVyTmFtZTogb3BlbnNoaWZ0LXByb2QKICBjdXN0b21fYW5ub3RhdGlvbnM6IFtdCiAgY3VzdG9tX3NldmVyaXR5X21hcDoge30KICBncmFmYW5hX2FwaV9rZXk6ICIiCiAgZ3JhZmFuYV9kYXNoYm9hcmRfdWlkOiAiIgogIGdyYWZhbmFfdXJsOiAiIgogIHByb21ldGhldXNfdXJsOiAiIgogIHNpZ25pbmdfa2V5OiAiIgoKYWxlcnRfcmVsYWJlbDoKICBbXQoKbGlnaHRfYWN0aW9uczoKICAtIHJlbGF0ZWRfcG9kcwogIC0gcHJvbWV0aGV1c19lbnJpY2hlcgogIC0gYWRkX3NpbGVuY2UKICAtIGRlbGV0ZV9wb2QKICAtIGRlbGV0ZV9zaWxlbmNlCiAgLSBnZXRfc2lsZW5jZXMKICAtIGxvZ3NfZW5yaWNoZXIKICAtIHBvZF9ldmVudHNfZW5yaWNoZXIKICAtIGRlcGxveW1lbnRfZXZlbnRzX2VucmljaGVyCiAgLSBqb2JfZXZlbnRzX2VucmljaGVyCiAgLSBqb2JfcG9kX2VucmljaGVyCiAgLSBnZXRfcmVzb3VyY2VfeWFtbAogIC0gbm9kZV9jcHVfZW5yaWNoZXIKICAtIG5vZGVfZGlza19hbmFseXplcgogIC0gbm9kZV9ydW5uaW5nX3BvZHNfZW5yaWNoZXIKICAtIG5vZGVfYWxsb2NhdGFibGVfcmVzb3VyY2VzX2VucmljaGVyCiAgLSBub2RlX3N0YXR1c19lbnJpY2hlcgogIC0gbm9kZV9ncmFwaF9lbnJpY2hlcgogIC0gb29ta2lsbGVkX2NvbnRhaW5lcl9ncmFwaF9lbnJpY2hlcgogIC0gcG9kX29vbV9raWxsZXJfZW5yaWNoZXIKICAtIG9vbV9raWxsZXJfZW5yaWNoZXIKICAtIHZvbHVtZV9hbmFseXNpcwogIC0gcHl0aG9uX3Byb2ZpbGVyCiAgLSBwb2RfcHMKICAtIHB5dGhvbl9tZW1vcnkKICAtIGRlYnVnZ2VyX3N0YWNrX3RyYWNlCiAgLSBweXRob25fcHJvY2Vzc19pbnNwZWN0b3IKICAtIHByb21ldGhldXNfYWxlcnQKICAtIGFsZXJ0bWFuYWdlcl9hbGVydAogIC0gY3JlYXRlX3B2Y19zbmFwc2hvdAogIC0gcmVzb3VyY2VfZXZlbnRzX2VucmljaGVyCiAgLSBkZWxldGVfam9iCiAgLSBsaXN0X3Jlc291cmNlX25hbWVzCiAgLSBub2RlX2RtZXNnX2VucmljaGVyCiAgLSBzdGF0dXNfZW5yaWNoZXIKICAtIGtycl9zY2FuCiAgLSBwb3BleWVfc2NhbgogIC0gaGFuZGxlX2FsZXJ0bWFuYWdlcl9ldmVudAogIC0gZHJhaW4KICAtIGNvcmRvbgogIC0gdW5jb3Jkb24KICAtIHJvbGxvdXRfcmVzdGFydAogIC0gYXNrX2hvbG1lcwogIC0gcHJvbWV0aGV1c19hbGxfYXZhaWxhYmxlX21ldHJpY3MKICAtIHByb21ldGhldXNfZ2V0X3NlcmllcwogIC0gcHJvbWV0aGV1c19nZXRfbGFiZWxfbmFtZXMKICAtIGhvbG1lc193b3JrbG9hZF9oZWFsdGgKICAtIGhvbG1lc19jb252ZXJzYXRpb24KICAtIGhvbG1lc19pc3N1ZV9jaGF0CiAgLSBob2xtZXNfY2hhdAogIC0gaG9sbWVzX3dvcmtsb2FkX2NoYXQKICAtIGxpc3RfcG9kcwoKYWN0aXZlX3BsYXlib29rczoKICAtIGFjdGlvbnM6CiAgICAtIG5hbWVfc2lsZW5jZXI6CiAgICAgICAgbmFtZXM6CiAgICAgICAgLSBXYXRjaGRvZwogICAgICAgIC0gS3ViZVNjaGVkdWxlckRvd24KICAgICAgICAtIEt1YmVDb250cm9sbGVyTWFuYWdlckRvd24KICAgICAgICAtIEluZm9JbmhpYml0b3IKICAgIG5hbWU6IENvbW1vblByb21ldGhldXNBbGVydHNTaWxlbmNlcgogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgc3RhdHVzOiBhbGwKICAtIGFjdGlvbnM6CiAgICAtIG5hbWVfc2lsZW5jZXI6CiAgICAgICAgbmFtZXM6CiAgICAgICAgLSBldGNkSW5zdWZmaWNpZW50TWVtYmVycwogICAgICAgIC0gZXRjZE1lbWJlcnNEb3duCiAgICAgICAgLSBOb2RlQ2xvY2tOb3RTeW5jaHJvbmlzaW5nCiAgICAgICAgLSBQcm9tZXRoZXVzVFNEQkNvbXBhY3Rpb25zRmFpbGluZwogICAgbmFtZTogTWluaUNsdXN0ZXJzUHJvbWV0aGV1c0FsZXJ0c1NpbGVuY2VyCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBrOHNfcHJvdmlkZXJzOgogICAgICAgIC0gTWluaWt1YmUKICAgICAgICAtIEtpbmQKICAgICAgICAtIFJhbmNoZXJEZXNrdG9wCiAgICAgICAgc3RhdHVzOiBhbGwKICAtIGFjdGlvbnM6CiAgICAtIG5hbWVfc2lsZW5jZXI6CiAgICAgICAgbmFtZXM6CiAgICAgICAgLSBLdWJlbGV0RG93bgogICAgbmFtZTogR0tFUHJvdmlkZXJBbGVydHNBbGVydHNTaWxlbmNlcgogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgazhzX3Byb3ZpZGVyczoKICAgICAgICAtIEdLRQogICAgICAgIHN0YXR1czogYWxsCiAgLSBhY3Rpb25zOgogICAgLSBzaWxlbmNlX2FsZXJ0OgogICAgICAgIGxvZ19zaWxlbmNlOiB0cnVlCiAgICBuYW1lOiBET05vZGVBZ2VudENQVVRocm90dGxpbmdIaWdoQWxlcnRTaWxlbmNlcgogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogQ1BVVGhyb3R0bGluZ0hpZ2gKICAgICAgICBrOHNfcHJvdmlkZXJzOgogICAgICAgIC0gRGlnaXRhbE9jZWFuCiAgICAgICAgcG9kX25hbWVfcHJlZml4OiBkby1ub2RlLWFnZW50CiAgLSBhY3Rpb25zOgogICAgLSB0YXJnZXRfZG93bl9kbnNfc2lsZW5jZXI6IHt9CiAgICBuYW1lOiBUYXJnZXREb3duU2lsZW5jZXIKICAgIHRyaWdnZXJzOgogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IFRhcmdldERvd24KICAtIGFjdGlvbnM6CiAgICAtIGxsc19hZ2VudF9hY3Rpb246IHt9ICMgYmFsYTogZnJvbSBjdXN0b20gYWN0aW9uIHNyZWlwcy1hY3Rpb24ucHkKICAgIC0gcG9kX2V2ZW50c19lbnJpY2hlcjoge30KICAgIHRyaWdnZXJzOgogICAgLSBvbl9wb2RfdXBkYXRlOgogICAgICAgIG5hbWVzcGFjZV9wcmVmaXg6ICJzcmVpcHMtdGVzdCIKICAtIGFjdGlvbnM6CiAgICAtIGRlZmF1bHRfZW5yaWNoZXI6IHt9CiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoge30KICAtIGFjdGlvbnM6CiAgICAtIHJlcG9ydF9jcmFzaF9sb29wOiB7fQogICAgLSBsbHNfYWdlbnRfYWN0aW9uOiB7fSAjIGJhbGE6IGZyb20gY3VzdG9tIGFjdGlvbiBzcmVpcHMtYWN0aW9uLnB5CiAgICBuYW1lOiBDcmFzaExvb3BCYWNrT2ZmCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcG9kX2NyYXNoX2xvb3A6CiAgICAgICAgcmVzdGFydF9yZWFzb246IENyYXNoTG9vcEJhY2tPZmYKICAtIGFjdGlvbnM6CiAgICAtIGltYWdlX3B1bGxfYmFja29mZl9yZXBvcnRlcjoge30KICAgIC0gbGxzX2FnZW50X2FjdGlvbjoge30gIyBiYWxhOiBmcm9tIGN1c3RvbSBhY3Rpb24gc3JlaXBzLWFjdGlvbi5weQogICAgbmFtZTogSW1hZ2VQdWxsQmFja09mZgogICAgdHJpZ2dlcnM6CiAgICAtIG9uX2ltYWdlX3B1bGxfYmFja29mZjoge30KICAtIGFjdGlvbnM6CiAgICAtIHBvZF9ldmljdGVkX2VucmljaGVyOiB7fQogICAgLSBwb2RfZXZlbnRzX2VucmljaGVyOiB7fQogICAgLSBlbnJpY2hfcG9kX3dpdGhfbm9kZV9ldmVudHM6IHt9CiAgICBuYW1lOiBQb2RFdmljdGVkCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcG9kX2V2aWN0ZWQ6IHt9CiAgLSBhY3Rpb25zOgogICAgLSBmYWlsX2tycl9zY2FuOiB7fQogICAgbmFtZTogS3JySm9iRmFpbGVkCiAgICB0cmlnZ2VyczoKICAgIC0gb25fam9iX2ZhaWx1cmU6CiAgICAgICAgc2NvcGU6CiAgICAgICAgICBpbmNsdWRlOgogICAgICAgICAgLSBsYWJlbHM6CiAgICAgICAgICAgIC0gYXBwPWtyci5yb2J1c3RhLmRldgogIC0gYWN0aW9uczoKICAgIC0gcG9kX29vbV9raWxsZXJfZW5yaWNoZXI6CiAgICAgICAgYXR0YWNoX2xvZ3M6IHRydWUKICAgICAgICBjb250YWluZXJfbWVtb3J5X2dyYXBoOiB0cnVlCiAgICAgICAgZG1lc2dfbG9nOiBmYWxzZQogICAgICAgIG5vZGVfbWVtb3J5X2dyYXBoOiB0cnVlCiAgICBuYW1lOiBQb2RPT01LaWxsCiAgICBzdG9wOiB0cnVlCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcG9kX29vbV9raWxsZWQ6CiAgICAgICAgcmF0ZV9saW1pdDogMzYwMAogIC0gYWN0aW9uczoKICAgIC0gbG9nc19lbnJpY2hlcjoge30KICAgIC0gcG9kX2V2ZW50c19lbnJpY2hlcjoge30KICAgIG5hbWU6IEt1YmVQb2RDcmFzaExvb3BpbmcKICAgIHRyaWdnZXJzOgogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IEt1YmVQb2RDcmFzaExvb3BpbmcKICAtIGFjdGlvbnM6CiAgICAtIHByb21ldGhldXNfcnVsZXNfZW5yaWNoZXI6IHt9CiAgICAtIGxvZ3NfZW5yaWNoZXI6CiAgICAgICAgZmlsdGVyX3JlZ2V4OiAuKkV2YWx1YXRpbmcgcnVsZSBmYWlsZWQuKgogICAgbmFtZTogUHJvbWV0aGV1c1J1bGVGYWlsdXJlcwogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogUHJvbWV0aGV1c1J1bGVGYWlsdXJlcwogIC0gYWN0aW9uczoKICAgIC0gY3B1X292ZXJjb21taXRlZF9lbnJpY2hlcjoge30KICAgIC0gZXh0ZXJuYWxfdmlkZW9fZW5yaWNoZXI6CiAgICAgICAgbmFtZTogQ1BVIE92ZXJjb21taXRlZAogICAgICAgIHVybDogaHR0cHM6Ly9iaXQubHkvb3ZlcmNvbW1pdC1jcHUKICAgIG5hbWU6IEt1YmVDUFVPdmVyY29tbWl0CiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBhbGVydF9uYW1lOiBLdWJlQ1BVT3ZlcmNvbW1pdAogIC0gYWN0aW9uczoKICAgIC0gbWVtb3J5X292ZXJjb21taXRlZF9lbnJpY2hlcjoge30KICAgIC0gZXh0ZXJuYWxfdmlkZW9fZW5yaWNoZXI6CiAgICAgICAgbmFtZTogTWVtb3J5IE92ZXJjb21taXRlZAogICAgICAgIHVybDogaHR0cHM6Ly9iaXQubHkvbWVtb3J5LW92ZXJjb21taXQKICAgIG5hbWU6IEt1YmVNZW1vcnlPdmVyY29tbWl0CiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBhbGVydF9uYW1lOiBLdWJlTWVtb3J5T3ZlcmNvbW1pdAogIC0gYWN0aW9uczoKICAgIC0gbG9nc19lbnJpY2hlcjoge30KICAgIC0gcG9kX2V2ZW50c19lbnJpY2hlcjoge30KICAgIC0gcG9kX2lzc3VlX2ludmVzdGlnYXRvcjoge30KICAgIG5hbWU6IEt1YmVQb2ROb3RSZWFkeQogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZVBvZE5vdFJlYWR5CiAgLSBhY3Rpb25zOgogICAgLSBwb2RfaXNzdWVfaW52ZXN0aWdhdG9yOiB7fQogICAgLSBwb2RfZXZlbnRzX2VucmljaGVyOiB7fQogICAgbmFtZTogS3ViZUNvbnRhaW5lcldhaXRpbmcKICAgIHRyaWdnZXJzOgogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IEt1YmVDb250YWluZXJXYWl0aW5nCiAgLSBhY3Rpb25zOgogICAgLSBocGFfbWlzbWF0Y2hfZW5yaWNoZXI6IHt9CiAgICBuYW1lOiBLdWJlSHBhUmVwbGljYXNNaXNtYXRjaAogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZUhwYVJlcGxpY2FzTWlzbWF0Y2gKICAtIGFjdGlvbnM6CiAgICAtIGpvYl9pbmZvX2VucmljaGVyOiB7fQogICAgLSBqb2JfZXZlbnRzX2VucmljaGVyOiB7fQogICAgLSBqb2JfcG9kX2VucmljaGVyOiB7fQogICAgbmFtZTogS3ViZUpvYkFsZXJ0cwogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZUpvYkZhaWxlZAogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IEt1YmVKb2JDb21wbGV0aW9uCiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZUpvYk5vdENvbXBsZXRlZAogIC0gYWN0aW9uczoKICAgIC0gYXBpX3NlcnZpY2Vfc3RhdHVzX2VucmljaGVyOiB7fQogICAgbmFtZTogS3ViZUFnZ3JlZ2F0ZWRBUElEb3duCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBhbGVydF9uYW1lOiBLdWJlQWdncmVnYXRlZEFQSURvd24KICAtIGFjdGlvbnM6CiAgICAtIG5vZGVfcG9kc19jYXBhY2l0eV9lbnJpY2hlcjoge30KICAgIC0gYWxlcnRfZXhwbGFuYXRpb25fZW5yaWNoZXI6CiAgICAgICAgYWxlcnRfZXhwbGFuYXRpb246IFRoZSBub2RlIGlzIGFwcHJvYWNoaW5nIHRoZSBtYXhpbXVtIG51bWJlciBvZiBzY2hlZHVsZWQgcG9kcy4KICAgICAgICByZWNvbW1lbmRlZF9yZXNvbHV0aW9uOiBWZXJpZnkgdGhhdCB5b3UgZGVmaW5lZCBwcm9wZXIgcmVzb3VyY2UgcmVxdWVzdHMgZm9yCiAgICAgICAgICB5b3VyIHdvcmtsb2Fkcy4gSWYgcG9kcyBjYW5ub3QgYmUgc2NoZWR1bGVkLCBhZGQgbW9yZSBub2RlcyB0byB5b3VyIGNsdXN0ZXIuCiAgICBuYW1lOiBLdWJlbGV0VG9vTWFueVBvZHMKICAgIHRyaWdnZXJzOgogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IEt1YmVsZXRUb29NYW55UG9kcwogIC0gYWN0aW9uczoKICAgIC0gbm9kZV9hbGxvY2F0YWJsZV9yZXNvdXJjZXNfZW5yaWNoZXI6IHt9CiAgICAtIG5vZGVfcnVubmluZ19wb2RzX2VucmljaGVyOiB7fQogICAgLSBzdGF0dXNfZW5yaWNoZXI6CiAgICAgICAgc2hvd19kZXRhaWxzOiB0cnVlCiAgICBuYW1lOiBLdWJlTm9kZU5vdFJlYWR5CiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBhbGVydF9uYW1lOiBLdWJlTm9kZU5vdFJlYWR5CiAgLSBhY3Rpb25zOgogICAgLSByZXNvdXJjZV9ldmVudHNfZW5yaWNoZXI6IHt9CiAgICAtIG5vZGVfc3RhdHVzX2VucmljaGVyOiB7fQogICAgbmFtZTogS3ViZU5vZGVVbnJlYWNoYWJsZQogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZU5vZGVVbnJlYWNoYWJsZQogIC0gYWN0aW9uczoKICAgIC0gcmVzb3VyY2VfZXZlbnRzX2VucmljaGVyOgogICAgICAgIGRlcGVuZGVudF9wb2RfbW9kZTogdHJ1ZQogICAgLSBzdGF0ZWZ1bHNldF9yZXBsaWNhc19lbnJpY2hlcjoge30KICAgIC0gcG9kX2lzc3VlX2ludmVzdGlnYXRvcjoge30KICAgIG5hbWU6IEt1YmVTdGF0ZWZ1bFNldFJlcGxpY2FzTWlzbWF0Y2gKICAgIHRyaWdnZXJzOgogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IEt1YmVTdGF0ZWZ1bFNldFJlcGxpY2FzTWlzbWF0Y2gKICAtIGFjdGlvbnM6CiAgICAtIHJlbGF0ZWRfcG9kczoge30KICAgIC0gc3RhdGVmdWxzZXRfcmVwbGljYXNfZW5yaWNoZXI6IHt9CiAgICBuYW1lOiBLdWJlU3RhdGVmdWxTZXRVcGRhdGVOb3RSb2xsZWRPdXQKICAgIHRyaWdnZXJzOgogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IEt1YmVTdGF0ZWZ1bFNldFVwZGF0ZU5vdFJvbGxlZE91dAogIC0gYWN0aW9uczoKICAgIC0gcmVzb3VyY2VfZXZlbnRzX2VucmljaGVyOiB7fQogICAgLSByZWxhdGVkX3BvZHM6IHt9CiAgICAtIGRhZW1vbnNldF9zdGF0dXNfZW5yaWNoZXI6IHt9CiAgICBuYW1lOiBLdWJlRGFlbW9uU2V0Um9sbG91dFN0dWNrCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBhbGVydF9uYW1lOiBLdWJlRGFlbW9uU2V0Um9sbG91dFN0dWNrCiAgLSBhY3Rpb25zOgogICAgLSBkYWVtb25zZXRfc3RhdHVzX2VucmljaGVyOiB7fQogICAgLSBkYWVtb25zZXRfbWlzc2NoZWR1bGVkX2FuYWx5c2lzX2VucmljaGVyOiB7fQogICAgbmFtZTogSzhzTWlzc2NoZWR1bGVkCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBhbGVydF9uYW1lOiBLdWJlcm5ldGVzRGFlbW9uc2V0TWlzc2NoZWR1bGVkCiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZURhZW1vblNldE1pc1NjaGVkdWxlZAogIC0gYWN0aW9uczoKICAgIC0gbm9kZV9jcHVfZW5yaWNoZXI6IHt9CiAgICAtIGFsZXJ0X2dyYXBoX2VucmljaGVyOgogICAgICAgIGl0ZW1fdHlwZTogTm9kZQogICAgICAgIHJlc291cmNlX3R5cGU6IENQVQogICAgbmFtZTogSG9zdEhpZ2hDcHVMb2FkCiAgICB0cmlnZ2VyczoKICAgIC0gb25fcHJvbWV0aGV1c19hbGVydDoKICAgICAgICBhbGVydF9uYW1lOiBIb3N0SGlnaENwdUxvYWQKICAtIGFjdGlvbnM6CiAgICAtIG9vbV9raWxsZXJfZW5yaWNoZXI6IHt9CiAgICAtIGFsZXJ0X2dyYXBoX2VucmljaGVyOgogICAgICAgIGl0ZW1fdHlwZTogTm9kZQogICAgICAgIHJlc291cmNlX3R5cGU6IE1lbW9yeQogICAgbmFtZTogSG9zdE9vbUtpbGxEZXRlY3RlZAogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogSG9zdE9vbUtpbGxEZXRlY3RlZAogIC0gYWN0aW9uczoKICAgIC0gbm9kZV9kaXNrX2FuYWx5emVyOiB7fQogICAgLSBhbGVydF9ncmFwaF9lbnJpY2hlcjoKICAgICAgICBpdGVtX3R5cGU6IE5vZGUKICAgICAgICByZXNvdXJjZV90eXBlOiBEaXNrCiAgICBuYW1lOiBOb2RlRlNTcGFjZUFsZXJ0cwogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogTm9kZUZpbGVzeXN0ZW1TcGFjZUZpbGxpbmdVcAogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IE5vZGVGaWxlc3lzdGVtQWxtb3N0T3V0T2ZTcGFjZQogIC0gYWN0aW9uczoKICAgIC0gY3B1X3Rocm90dGxpbmdfYW5hbHlzaXNfZW5yaWNoZXI6IHt9CiAgICAtIGFsZXJ0X2dyYXBoX2VucmljaGVyOgogICAgICAgIGl0ZW1fdHlwZTogUG9kCiAgICAgICAgcmVzb3VyY2VfdHlwZTogQ1BVCiAgICBuYW1lOiBDUFVUaHJvdHRsaW5nSGlnaAogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogQ1BVVGhyb3R0bGluZ0hpZ2gKICAgICAgICBzdGF0dXM6IGFsbAogIC0gYWN0aW9uczoKICAgIC0gcG9kX2lzc3VlX2ludmVzdGlnYXRvcjoge30KICAgIC0gZGVwbG95bWVudF9ldmVudHNfZW5yaWNoZXI6CiAgICAgICAgaW5jbHVkZWRfdHlwZXM6CiAgICAgICAgLSBXYXJuaW5nCiAgICAtIGRlcGxveW1lbnRfZXZlbnRzX2VucmljaGVyOgogICAgICAgIGRlcGVuZGVudF9wb2RfbW9kZTogdHJ1ZQogICAgICAgIGluY2x1ZGVkX3R5cGVzOgogICAgICAgIC0gV2FybmluZwogICAgICAgIC0gTm9ybWFsCiAgICBuYW1lOiBEZXBsb3ltZW50UmVwbGljYXNNaXNtYXRjaAogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZXJuZXRlc0RlcGxveW1lbnRSZXBsaWNhc01pc21hdGNoCiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZURlcGxveW1lbnRSZXBsaWNhc01pc21hdGNoCiAgLSBhY3Rpb25zOgogICAgLSB2ZXJzaW9uX21pc21hdGNoX2VucmljaGVyOiB7fQogICAgbmFtZTogS3ViZVZlcnNpb25NaXNtYXRjaAogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogS3ViZVZlcnNpb25NaXNtYXRjaAogIC0gYWN0aW9uczoKICAgIC0gZGVmYXVsdF9lbnJpY2hlcjoge30KICAgIG5hbWU6IERlZmF1bHRQcm9tZXRoZXVzQWxlcnRFbnJpY2hlcgogICAgdHJpZ2dlcnM6CiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgc3RhdHVzOiBhbGwKICAtIGFjdGlvbnM6CiAgICAtIGFsZXJ0X2V4cGxhbmF0aW9uX2VucmljaGVyOgogICAgICAgIGFsZXJ0X2V4cGxhbmF0aW9uOiBUaGlzIGFsZXJ0IGlzIGZpcmVkIHdoZW4gdGhlIGZpbGUgc3lzdGVtIGlzIHJ1bm5pbmcgb3V0IG9mCiAgICAgICAgICBzcGFjZS4KICAgICAgICByZWNvbW1lbmRlZF9yZXNvbHV0aW9uOiBUaGlzIGlzIGEgY29tbW9uIGlzc3VlIG9uIGxvY2FsIGNsdXN0ZXJzIGFuZCB3ZSByZWNvbW1lbmQKICAgICAgICAgIGluY3JlYXNpbmcgdGhlIG5vZGUgZGlzayBzaXplIGZvciB5b3VyIGNsdXN0ZXIgdG8gcnVuIG9wdGltYWxseS4KICAgIG5hbWU6IE1pbmlDbHVzdGVyTm9kZUZTU3BhY2VBbGVydHMKICAgIHRyaWdnZXJzOgogICAgLSBvbl9wcm9tZXRoZXVzX2FsZXJ0OgogICAgICAgIGFsZXJ0X25hbWU6IE5vZGVGaWxlc3lzdGVtU3BhY2VGaWxsaW5nVXAKICAgICAgICBrOHNfcHJvdmlkZXJzOgogICAgICAgIC0gTWluaWt1YmUKICAgICAgICAtIEtpbmQKICAgICAgICAtIFJhbmNoZXJEZXNrdG9wCiAgICAtIG9uX3Byb21ldGhldXNfYWxlcnQ6CiAgICAgICAgYWxlcnRfbmFtZTogTm9kZUZpbGVzeXN0ZW1BbG1vc3RPdXRPZlNwYWNlCiAgICAgICAgazhzX3Byb3ZpZGVyczoKICAgICAgICAtIE1pbmlrdWJlCiAgICAgICAgLSBLaW5kCiAgICAgICAgLSBSYW5jaGVyRGVza3RvcA==
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  name: sreips-runner-secret
  namespace: sreips-core
type: Opaque
stringData:
  SENTRY_DSN: https://4f1a66f025c60830fec303a094dcdf94@o1120648.ingest.sentry.io/6156573
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: sreips-kubewatch-config
  namespace: sreips-core
data:
  .kubewatch.yaml: |-
    handler:
      cloudevent:
        url: "http://sreips-runner:80/api/handle"
    namespace: ""
    resource:
      clusterrole: true
      clusterrolebinding: true
      configmap: true
      coreevent: false
      daemonset: true
      deployment: true
      event: true
      hpa: true
      ingress: true
      job: true
      namespace: true
      node: true
      persistentvolume: true
      pod: true
      replicaset: true
      replicationcontroller: false
      secret: false
      serviceaccount: true
      services: true
      statefulset: true
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: sreips-forwarder-cluster-role
  namespace : sreips
rules:
  - apiGroups:
      - ""
    resources:
      - configmaps
      - daemonsets
      - deployments
      - events
      - namespaces
      - nodes
      - persistentvolumes
      - pods
      - replicasets
      - replicationcontrollers
      #- secrets
      - services
      - serviceaccounts
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - "networking.k8s.io"
    resources:
      - ingresses
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - "autoscaling"
    resources:
      - horizontalpodautoscalers
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - "events.k8s.io"
    resources:
      - events
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      - clusterroles
      - clusterrolebindings
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - apps
    resources:
      - daemonsets
      - deployments
      - deployments/scale
      - replicasets
      - replicasets/scale
      - statefulsets
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - extensions
    resources:
      - daemonsets
      - deployments
      - deployments/scale
      - ingresses
      - replicasets
      - replicasets/scale
      - replicationcontrollers/scale
    verbs:
      - get
      - list
      - watch
    
  - apiGroups:
      - batch
    resources:
      - cronjobs
      - jobs
    verbs:
      - get
      - list
      - watch
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: sreips-runner-cluster-role
  namespace : sreips
rules:
  - apiGroups:
      - ""
    resources:
      - configmaps
      - daemonsets
      - deployments
      - events
      - namespaces
      - persistentvolumes
      - persistentvolumeclaims
      - pods
      - pods/status
      - pods/exec
      - pods/log
      - replicasets
      - replicationcontrollers
      - services
      - serviceaccounts
      - endpoints
      - secrets
      
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - ""
    resources:
      - nodes
    verbs:
      - get
      - list
      - watch
      - patch

  - apiGroups:
      - ""
    resources:
      - configmaps
      - persistentvolumes
      - persistentvolumeclaims
      - pods
      - pods/status
      - pods/exec
      - pods/log
      - pods/eviction
    verbs:
      - delete
      - create
      - patch
      - update

  - apiGroups:
      - ""
    resources:
      - secrets
    verbs:
      - create

  - apiGroups:
      - "apiregistration.k8s.io"
    resources:
      - apiservices
    verbs:
      - get
      - list

  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      - clusterroles
      - clusterrolebindings
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - "autoscaling"
    resources:
      - horizontalpodautoscalers
    verbs:
      - get
      - list
      - watch
      - patch
      - update

  - apiGroups:
      - apps
    resources:
      - daemonsets
      - deployments
      - deployments/scale
      - replicasets
      - replicasets/scale
      - statefulsets
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - apps
    resources:
      - deployments
    verbs:
      - create
      - patch
      - delete

  - apiGroups:
      - apps
    resources:
      - daemonsets
      - statefulsets
    verbs:
      - patch

  - apiGroups:
      - extensions
    resources:
      - daemonsets
      - deployments
      - deployments/scale
      - ingresses
      - replicasets
      - replicasets/scale
      - replicationcontrollers/scale
    verbs:
      - get
      - list
      - watch

  - apiGroups:
      - batch
    resources:
      - cronjobs
      - jobs
    verbs:
      - get
      - list
      - watch
      - patch
      - delete
      - create

  - apiGroups:
      - "events.k8s.io"
    resources:
      - events
    verbs:
      - get
      - list

  - apiGroups:
      - networking.k8s.io
    resources:
    - ingresses
    - networkpolicies
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - autoscaling
    resources:
    - horizontalpodautoscalers
    verbs:
      - get
      - list
  - apiGroups:
      - "policy"
    resources:
    - poddisruptionbudgets
    - podsecuritypolicies
    verbs:
      - get
      - list
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
    - clusterroles
    - clusterrolebindings
    - roles
    - rolebindings
    verbs:
      - get
      - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: sreips-forwarder-cluster-role-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: sreips-forwarder-cluster-role
subjects:
  - kind: ServiceAccount
    name: sreips-forwarder-service-account
    namespace: sreips-core
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: sreips-runner-cluster-role-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: sreips-runner-cluster-role
subjects:
  - kind: ServiceAccount
    name: sreips-runner-service-account
    namespace: sreips-core
---
apiVersion: v1
kind: Service
metadata:
  name: sreips-forwarder
  namespace: sreips-core
  labels:
    app: sreips-forwarder
spec:
  selector:
    app: sreips-forwarder
  ports:
    - name: forwarder-metrics
      protocol: TCP
      port: 80
      targetPort: 2112
---
apiVersion: v1
kind: Service
metadata:
  name: sreips-runner
  namespace: sreips-core
  labels:
    app: sreips-runner
    target: sreips-runner
spec:
  selector:
    app: sreips-runner
  ports:
    - name: http
      protocol: TCP
      port: 80
      targetPort: 5000
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sreips-forwarder
  namespace: sreips-core
  labels:
    sreips: forwarder
    app: sreips-forwarder
    target: sreips-forwarder
spec:
  selector:
    matchLabels:
      app: sreips-forwarder
  replicas: 1
  revisionHistoryLimit: 10
  template:
    metadata:
      annotations:
        checksum/config: ccef035b401896ffb6c28711036c0474d0b52adff77e636b0f8ecc6130795c9d
      labels:
        app: sreips-forwarder
    spec:
      serviceAccountName: sreips-forwarder-service-account
      automountServiceAccountToken: true
      containers:
      - name: kubewatch
        # this is a custom version of kubewatch built from https://github.com/aantn/kubewatch
        image: quay.io/balki404/sreips-kubewatch:v2.11.0
        imagePullPolicy: IfNotPresent
        env:
          - name: KW_CONFIG
            value: /config
          - name: ENABLE_PPROF
            value: "true"
        volumeMounts:
          - name: sreips-kubewatch-config
            mountPath: /config
        securityContext:
            allowPrivilegeEscalation: false
            capabilities: {}
            privileged: false
            readOnlyRootFilesystem: false
        resources:
          requests:
            cpu: 10m
            memory: "512Mi"
          limits:
            memory: "512Mi"
            
      volumes:
        - name:  sreips-kubewatch-config
          configMap:
            name: sreips-kubewatch-config
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sreips-runner
  namespace: sreips-core
  labels:
    sreips: runner
    app: sreips-runner
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: sreips-runner
  template:
    metadata:
      labels:
        app: sreips-runner
        robustaComponent: "runner"
    spec:
      serviceAccountName: sreips-runner-service-account
      automountServiceAccountToken: true
      containers:
      - name: runner
        image: quay.io/balki404/sreips-runner:0.0.13
        imagePullPolicy: IfNotPresent
        securityContext:
            allowPrivilegeEscalation: false
            capabilities: {}
            privileged: false
            readOnlyRootFilesystem: false
        env:
          - name: PLAYBOOKS_CONFIG_FILE_PATH
            value: /etc/robusta/config/active_playbooks.yaml
          - name: RELEASE_NAME
            value: "robusta"
          - name: PROMETHEUS_ENABLED
            value: "false"
          - name: MANAGED_CONFIGURATION_ENABLED
            value: "false"
          - name: SEND_ADDITIONAL_TELEMETRY
            value: "false"
          - name: LOG_LEVEL
            value: INFO
          - name: INSTALLATION_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: RUNNER_VERSION
            value: 0.28.1
          - name: CERTIFICATE
            value: 
          - name: IMAGE_REGISTRY
            value: robustadev
          - name: CLUSTER_DOMAIN
            value: cluster.local
          - name: SET_KRR_SECURITY_CONTEXT
            value: "false"
        envFrom:
        - secretRef:
            name: sreips-runner-secret
            optional: true
        volumeMounts:
          - name: auth-config-secret
            mountPath: /etc/robusta/auth
          - name: playbooks-config-secret
            mountPath: /etc/robusta/config
        lifecycle:
          preStop:
            exec:
              command: ["bash", "-c", "kill -SIGINT 1"]
        resources:
          requests:
            cpu: 250m
            memory: "1024Mi"
          limits:
            memory: "1024Mi"
            
      volumes:
        - name: playbooks-config-secret
          secret:
            secretName: sreips-playbooks-config-secret
            optional: true
        - name: auth-config-secret
          secret:
            secretName: robusta-auth-config-secret
            optional: true
